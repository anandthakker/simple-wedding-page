// Generated by CoffeeScript 1.6.3
(function() {
  angular.module("athreadofsomething", ["firebase"]).controller("RsvpCtrl", function($scope) {
    return $scope.rsvp = {
      attending: true
    };
  }).directive("firebaseForm", function($firebase) {
    return {
      restrict: "A",
      replace: true,
      transclude: true,
      template: "<div class=\"firebase-form\">\n  <div class=\"message error\" ng-show=\"error\">\n    {{errorMsg}}\n  </div>\n\n  <form ng-show=\"error || (!success && !saving)\" ng-transclude>\n  </form>\n\n  <div class=\"message waiting\" ng-show=\"saving\">\n    {{waitingMsg}}\n  </div>\n  <div class=\"message success\" ng-show=\"success\">\n    {{successMsg}}\n  </div>\n\n</div>\n",
      link: function(scope, element, attrs) {
        var db, _ref, _ref1, _ref2;
        db = new Firebase(attrs.firebaseUrl);
        scope.waitingMsg = (_ref = attrs.waitingMsg) != null ? _ref : "Saving...";
        scope.successMsg = (_ref1 = attrs.successMsg) != null ? _ref1 : "Thank you. Your response has been saved.";
        scope.errorMsg = (_ref2 = attrs.errorMsg) != null ? _ref2 : "There was a problem saving your response.";
        scope.saving = null;
        scope.success = null;
        scope.error = null;
        return scope.save = function() {
          var newRef;
          console.log("Save");
          scope.data = scope.$eval(attrs.firebaseFormData);
          console.log(scope.data);
          scope.saving = true;
          newRef = db.push();
          return newRef.set(scope.data, function(error) {
            return scope.$apply(function() {
              console.log(error);
              scope.saving = false;
              if (error != null) {
                return scope.error = error;
              } else {
                return scope.success = true;
              }
            });
          });
        };
      }
    };
  });

  /*
  Yes, it would be more pure to Angular-ify this.
  */


  $(function() {
    var navigation_links, navigation_listItems;
    $('nav').waypoint('sticky');
    /*
    Code below borrowed from https://github.com/bmgdev/responsive-wedding/blob/master/js/main-1.6.js
    Copyright Â© Scal.io, LLC Bradley Greenwood
    */

    navigation_listItems = $('nav li');
    navigation_links = $('nav li a');
    $('#container>section').waypoint({
      handler: function(event, direction) {
        var active_listItem, active_section;
        active_section = void 0;
        active_section = $(this);
        if (direction === "up") {
          active_section = active_section.prev();
        }
        active_listItem = $("nav a[href=\"#" + active_section.attr("id") + "\"]").parent();
        navigation_listItems.removeClass("selected");
        active_listItem.addClass("selected");
      },
      offset: "15%"
    });
    return navigation_links.click(function(event) {
      $.scrollTo($(this).attr("href"), {
        duration: 1000,
        offset: {
          left: 0,
          top: -0.08 * $(window).height()
        }
      });
      event.preventDefault();
    });
  });

}).call(this);
